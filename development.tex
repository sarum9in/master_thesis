\chapter{Разработка RPC на основе брокера сообщений}
В данной главе рассматривается процесс разработки RPC на основе
брокера сообщений RabbitMQ. Оценивается производительность сервисов BACS,
созданных на основе реализованного RPC.

\section{Реализация RPC}
% Общая схема: Архитектура общая, архитектура модулей
% Результат: эксперимент, оценка производительности сервиса задач/секунду, графики

\subsection{Общая архитектура}
При реализации RPC для конкретных платформ важно придерживаться стиля
программирования, принятого в рамках самой платформы. Тем не менее
можно выделить ряд особенностей, связанных с брокером.

Важным достоинством протокола AMQP~\cite{amqp} является его популярность,
и как следствие, существует существенное количество его реализаций.
В работе представлена реализация протокола RPC для трёх платформ Go, Python
и C\#, но в случае реализации протокола для других платформ с императивными
языками программирования рекомендуется придерживаться аналогичной архитектуры.

За основу реализации берётся существующая библиотека AMQP, а также библиотека
Google Protocol Buffers. Используя эти две библиотеки строится логика работы
с подключениями к брокеру, обработка и пересылка сообщений,
см. рисунок~\ref{fig:libbrokercomponents}.

\begin{figure}[H]
    \centering
    \includegraphics[width=\columnwidth]{rs/libbrokercomponents}
    \caption{Устройство библиотек}
    \label{fig:libbrokercomponents}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=\columnwidth]{rs/libbroker}
    \caption{Устройство библиотек}
    \label{fig:libbroker}
\end{figure}

При разработке библиотек выделяется общий компонент -- менеджер подключения.
Он отвечает за установку и восстановление соединения с брокером.
Такая прослойка позволяет упростить логику работы вышестоящих объектов,
На основе менеджера подключения создаются классы отправителя и получателя
сообщений, см. рис.~\ref{fig:libbroker}.

%\subsection{Особенности Go}
%\subsection{Особенности Python}
%\subsection{Особенности C\#}

\section{Применение разработанных программных решений}
Разработанный RPC успешно применяется в олимпиадной системе BACS.
Он используется в системе тестирования для передачи пользовательских
решений в кластер серверов для обработки. Каждое решение тестируется
при помощи специальных модулей, создаваемых автоматически
для каждой имеющейся в системе задачи. Модули генерируются Архивом задач
на основе данных самих задач и помещаются в репозиторий. Сервисы BACS
скачивают модули из репозитория при помощи библиотеки bunsan::pm~\cite{bunsanpm}
и применяют их для тестирования задач. Общая схема работы системы
представлена на рисунке~\ref{fig:bacsservice}.

\begin{figure}[H]
    \centering
    \input rs/bacsservice.dot
    \caption{Сервисы системы BACS}
    \label{fig:bacsservice}
\end{figure}

\subsection{Эффективность представленного решения}

\section{Выводы}

% vim: spell spelllang=ru
